"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[382],{65174:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(57437),a=n(27648);function s(e){let{message:t="Demo Data Unavailable",backHref:n,backLabel:s="Go Back"}=e;return(0,r.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-12 h-12 rounded-full bg-red-50 flex items-center justify-center mx-auto mb-3",children:(0,r.jsx)("svg",{className:"w-6 h-6 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,r.jsx)("p",{className:"text-sm text-red-500 mb-2",children:t}),n&&(0,r.jsx)(a.default,{href:n,className:"text-sm text-blue-600 hover:underline",children:s})]})})}},70279:function(e,t,n){n.d(t,{IZ:function(){return a}});var r=n(57437);function a(){return(0,r.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("span",{className:"text-sm text-gray-400",children:"Loading..."})]})})}},91591:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(57437),a=n(65056);let s={normal:"Normal",surge:"Surge",weather:"Weather",dismissal:"Dismissal"};function o(e){let{snapshotId:t,timestamp:n,title:o="Operations Console"}=e,{config:i,updateConfig:l}=(0,a.c)(),c=n?function(e){let t=new Date(e),n=String(t.getUTCHours()).padStart(2,"0"),r=String(t.getUTCMinutes()).padStart(2,"0"),a=String(t.getUTCSeconds()).padStart(2,"0");return"".concat(n,":").concat(r,":").concat(a," UTC")}(n):"--:--:--";return(0,r.jsxs)("header",{className:"h-14 bg-white border-b border-gray-200 flex items-center justify-between px-6 shrink-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("h1",{className:"text-sm font-semibold text-gray-900",children:o}),t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-xs text-gray-400",children:"|"}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["Snapshot: ",t]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("select",{value:i.scenario,onChange:e=>l({scenario:e.target.value}),className:"text-xs border border-gray-200 rounded-md px-2 py-1 text-gray-600 bg-white",children:Object.keys(s).map(e=>(0,r.jsx)("option",{value:e,children:s[e]},e))}),(0,r.jsx)("button",{onClick:()=>l({timeMode:"live"===i.timeMode?"paused":"live"}),className:"flex items-center gap-1.5 text-xs px-2 py-1 rounded-md border ".concat("live"===i.timeMode?"border-green-200 bg-green-50 text-green-700":"border-amber-200 bg-amber-50 text-amber-700"),children:"live"===i.timeMode?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"relative flex h-2 w-2",children:[(0,r.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),(0,r.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),"Live"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"inline-flex rounded-full h-2 w-2 bg-amber-500"}),"Paused"]})}),(0,r.jsx)("span",{className:"text-xs font-mono text-gray-600",children:c})]})]})}},88662:function(e,t,n){n.d(t,{LiveStateProvider:function(){return p},j:function(){return h}});var r=n(57437),a=n(2265),s=n(3985),o=n(72510),i=n(83639),l=n(21212);function c(e){switch(e){case s.pr.INITIAL:return s.pr.SNAPSHOT_1;case s.pr.SNAPSHOT_1:return s.pr.SNAPSHOT_2;case s.pr.SNAPSHOT_2:return s.pr.SNAPSHOT_1}}var u=n(65056);let d=new Set(["LOW","MED","HIGH"]);function m(e,t){for(let t of e)l.vU("Validation: ".concat(t));return(0,i.sv)(),{valid:!1,errors:e,warnings:t}}let f=(0,a.createContext)({liveState:null,loading:!0,error:null,lastValidation:null,applyDemo:()=>{}});function h(){return(0,a.useContext)(f)}function p(e){let{children:t}=e,{config:n}=(0,u.c)(),[h,p]=(0,a.useState)(null),[v,g]=(0,a.useState)(null),[b,x]=(0,a.useState)(!0),[_,y]=(0,a.useState)(null),[S,j]=(0,a.useState)(null),N=(0,a.useRef)(s.pr.INITIAL),w=(0,a.useRef)(null),A=(0,a.useCallback)(async(e,t,n)=>{var r;null===(r=w.current)||void 0===r||r.abort();let a=new AbortController;w.current=a;try{let r=function(e){switch(e){case s.pr.INITIAL:case s.pr.SNAPSHOT_1:return"live_state_1.json";case s.pr.SNAPSHOT_2:return"live_state_2.json"}}(e),c=await (0,o.SE)(r,t,a.signal);if(a.signal.aborted)return;if(c){if(n){let e=function(e){let t=[],n=[];if(!e||"object"!=typeof e)return t.push("LiveState must be a non-null object"),m(t,n);if(("string"!=typeof e.snapshot_id||0===e.snapshot_id.length)&&t.push("snapshot_id must be a non-empty string"),("string"!=typeof e.timestamp||0===e.timestamp.length)&&t.push("timestamp must be a non-empty string"),"string"==typeof e.district_risk&&d.has(e.district_risk)||t.push('district_risk must be one of LOW, MED, HIGH; got "'.concat(e.district_risk,'"')),("number"!=typeof e.active_alerts||e.active_alerts<0)&&t.push("active_alerts must be a non-negative number"),"number"!=typeof e.avg_latency_ms&&t.push("avg_latency_ms must be a number"),"number"!=typeof e.camera_health_pct&&t.push("camera_health_pct must be a number"),"number"!=typeof e.forecast_horizon_min&&t.push("forecast_horizon_min must be a number"),Array.isArray(e.zones))for(let n=0;n<e.zones.length;n++){let r=function(e,t){let n=[],r="zones[".concat(t,"]");return e&&"object"==typeof e?(("string"!=typeof e.zone_id||0===e.zone_id.length)&&n.push("".concat(r,".zone_id must be a non-empty string")),("string"!=typeof e.name||0===e.name.length)&&n.push("".concat(r,".name must be a non-empty string")),"string"==typeof e.risk_level&&d.has(e.risk_level)||n.push("".concat(r,".risk_level invalid")),("number"!=typeof e.risk_score||e.risk_score<0||e.risk_score>1)&&n.push("".concat(r,".risk_score must be 0..1")),Array.isArray(e.forecast_30m)||n.push("".concat(r,".forecast_30m must be an array")),Array.isArray(e.recommendations)||n.push("".concat(r,".recommendations must be an array")),Array.isArray(e.events)||n.push("".concat(r,".events must be an array")),Array.isArray(e.interventions)||n.push("".concat(r,".interventions must be an array"))):n.push("".concat(r," must be a non-null object")),n}(e.zones[n],n);t.push(...r)}else t.push("zones must be an array");return t.length>0?m(t,n):(e.avg_latency_ms>200&&n.push("High latency: ".concat(e.avg_latency_ms,"ms")),e.camera_health_pct<90&&n.push("Low camera health: ".concat(e.camera_health_pct,"%")),{valid:!0,errors:[],warnings:n})}(c);j(e),e.valid||l.ZK("Snapshot validation failed",e.errors)}p(c),y(null),(0,i.vP)()}else y("Demo Data Unavailable")}catch(e){"AbortError"!==e.name&&y("Demo Data Unavailable")}finally{x(!1)}},[]);(0,a.useEffect)(()=>{let e=c(N.current);if(N.current=e,A(e,n.scenario,n.runtimeValidationEnabled),"paused"===n.timeMode)return;let t=setInterval(()=>{let e=c(N.current);N.current=e,A(e,n.scenario,n.runtimeValidationEnabled)},n.snapshotIntervalMs);return()=>{var e;clearInterval(t),null===(e=w.current)||void 0===e||e.abort()}},[A,n.scenario,n.timeMode,n.snapshotIntervalMs,n.runtimeValidationEnabled]);let I=(0,a.useCallback)((e,t)=>{if(!n.demoMutationEnabled){l.um("Demo mutation disabled, ignoring apply");return}let r=null!=v?v:h;r&&g(function(e,t,n){let r=new Date,a=[String(r.getUTCHours()).padStart(2,"0"),String(r.getUTCMinutes()).padStart(2,"0"),String(r.getUTCSeconds()).padStart(2,"0")].join(":"),s={id:"demo-int-".concat(Date.now()),action:n.action,applied_at:a,status:"active"},o={time:a,type:"intervention",detail:"[Demo] Applied: ".concat(n.action)},c=e.zones.map(e=>e.zone_id!==t?e:{...e,interventions:[...e.interventions,s],events:[...e.events,o]});return(0,i.L8)(),l.um("Demo intervention applied: ".concat(n.action," in ").concat(t)),{...e,zones:c}}(r,e,t))},[v,h,n.demoMutationEnabled]),k=(0,a.useMemo)(()=>h?function(e,t){if(!t)return e;let n=new Map;for(let e of t.zones)n.set(e.zone_id,e);let r=e.zones.map(e=>{let t=n.get(e.zone_id);if(!t)return e;let r=t.interventions.filter(e=>e.id.startsWith("demo-int-")),a=t.events.filter(e=>e.detail.startsWith("[Demo]"));return 0===r.length&&0===a.length?e:{...e,interventions:[...e.interventions,...r],events:[...e.events,...a]}});return{...e,zones:r}}(h,v):null,[h,v]),M=(0,a.useMemo)(()=>({liveState:k,loading:b,error:_,lastValidation:S,applyDemo:I}),[k,b,_,S,I]);return(0,r.jsx)(f.Provider,{value:M,children:t})}},72510:function(e,t,n){n.d(t,{SE:function(){return o},uq:function(){return i}});var r=n(65056),a=n(21212),s=n(83639);async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=arguments.length>2?arguments[2]:void 0,o=performance.now();try{let i=await fetch("".concat((0,r.f)(t),"/").concat(e),{signal:n});if(!i.ok)throw Error("Failed to load live state: ".concat(i.status));let l=await i.json();return(0,s._h)(performance.now()-o,!0),a.um("Loaded snapshot ".concat(e," (").concat(t,")")),l}catch(e){return"AbortError"!==e.name&&(a.vU("loadLiveState failed",e),(0,s._h)(performance.now()-o,!1)),null}}async function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=arguments.length>1?arguments[1]:void 0,n=performance.now();try{let a=await fetch("".concat((0,r.f)(e),"/incidents.json"),{signal:t});if(!a.ok)throw Error("Failed to load incidents: ".concat(a.status));let o=await a.json();return(0,s._h)(performance.now()-n,!0),{data:o,error:null}}catch(e){return"AbortError"!==e.name&&(a.vU("loadIncidents failed",e),(0,s._h)(performance.now()-n,!1)),{data:[],error:"Demo Data Unavailable"}}}},65056:function(e,t,n){n.d(t,{DemoConfigProvider:function(){return c},c:function(){return l},f:function(){return u}});var r=n(57437),a=n(2265);let s={scenario:"normal",snapshotIntervalMs:5e3,timeMode:"live",demoMutationEnabled:!0,runtimeValidationEnabled:!0},o="schoolzone-demo-config",i=(0,a.createContext)({config:s,updateConfig:()=>{}});function l(){return(0,a.useContext)(i)}function c(e){let{children:t}=e,[n,l]=(0,a.useState)(s);(0,a.useEffect)(()=>{l(function(){try{let e=localStorage.getItem(o);if(!e)return s;let t=JSON.parse(e);return{...s,...t}}catch(e){return s}}())},[]);let c=(0,a.useCallback)(e=>{l(t=>{let n={...t,...e};return!function(e){try{localStorage.setItem(o,JSON.stringify(e))}catch(e){}}(n),n})},[]);return(0,r.jsx)(i.Provider,{value:{config:n,updateConfig:c},children:t})}function u(e){return"/mock/scenarios/".concat(e)}},21212:function(e,t,n){n.d(t,{AF:function(){return c},ZK:function(){return i},um:function(){return o},vU:function(){return l}});let r=[];function a(){return new Date().toISOString()}function s(e){r.push(e),r.length>200&&r.shift()}function o(e,t){s({level:"info",timestamp:a(),message:e,data:t})}function i(e,t){s({level:"warn",timestamp:a(),message:e,data:t})}function l(e,t){s({level:"error",timestamp:a(),message:e,data:t})}function c(){return r}},83639:function(e,t,n){n.d(t,{Kt:function(){return l},L8:function(){return o},_h:function(){return a},sv:function(){return i},vP:function(){return s}});let r={fetchCount:0,fetchErrorCount:0,lastFetchMs:0,lastFetchAt:null,snapshotRotations:0,demoMutationsApplied:0,validationFailures:0};function a(e,t){r.fetchCount++,r.lastFetchMs=e,r.lastFetchAt=new Date().toISOString(),!t&&r.fetchErrorCount++}function s(){r.snapshotRotations++}function o(){r.demoMutationsApplied++}function i(){r.validationFailures++}function l(){return{...r}}},3985:function(e,t,n){var r,a,s,o;n.d(t,{pr:function(){return a},rN:function(){return r}}),(s=r||(r={})).LOW="LOW",s.MED="MED",s.HIGH="HIGH",(o=a||(a={})).INITIAL="INITIAL",o.SNAPSHOT_1="SNAPSHOT_1",o.SNAPSHOT_2="SNAPSHOT_2"},97871:function(e,t,n){n.d(t,{i:function(){return r.j}});var r=n(88662)}}]);