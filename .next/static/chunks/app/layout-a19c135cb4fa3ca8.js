(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{28279:function(e,t,n){Promise.resolve().then(n.t.bind(n,47960,23)),Promise.resolve().then(n.bind(n,63119)),Promise.resolve().then(n.bind(n,93583)),Promise.resolve().then(n.bind(n,65056)),Promise.resolve().then(n.bind(n,88662)),Promise.resolve().then(n.t.bind(n,44742,23))},63119:function(e,t,n){"use strict";n.d(t,{default:function(){return c}});var r=n(57437),a=n(27648),o=n(99376);let s=[{title:"Executive",items:[{href:"/executive",label:"Command Brief",icon:"briefcase"}]},{title:"Operations",items:[{href:"/operations/dashboard",label:"Dashboard",icon:"grid"},{href:"/operations/queue",label:"Work Queue",icon:"queue"}]},{title:"Governance",items:[{href:"/governance/incidents",label:"Incidents",icon:"alert"},{href:"/governance/controls",label:"Controls",icon:"shield"}]}];function i(e){let{type:t}=e;switch(t){case"briefcase":return(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})});case"grid":return(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})});case"queue":return(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})});case"alert":return(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"shield":return(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})});default:return(0,r.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("circle",{cx:"12",cy:"12",r:"3",strokeWidth:2})})}}function c(){let e=(0,o.usePathname)();return(0,r.jsxs)("aside",{className:"w-56 bg-white border-r border-gray-200 flex flex-col min-h-screen shrink-0",children:[(0,r.jsx)("div",{className:"px-5 py-5 border-b border-gray-200",children:(0,r.jsxs)(a.default,{href:"/executive",className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})}),(0,r.jsx)("span",{className:"font-semibold text-gray-900 text-sm",children:"SchoolZone"})]})}),(0,r.jsx)("nav",{className:"flex-1 px-3 py-3 space-y-4 overflow-y-auto",children:s.map(t=>(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"px-3 mb-1 text-[10px] font-semibold text-gray-400 uppercase tracking-wider",children:t.title}),(0,r.jsx)("div",{className:"space-y-0.5",children:t.items.map(t=>{var n;let o="/executive"===(n=t.href)?"/executive"===e||e.startsWith("/executive/"):e===n||e.startsWith(n+"/");return(0,r.jsxs)(a.default,{href:t.href,className:"flex items-center gap-2.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors ".concat(o?"bg-blue-50 text-blue-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,r.jsx)(i,{type:t.icon}),t.label]},t.href)})})]},t.title))}),(0,r.jsxs)("div",{className:"px-3 py-3 border-t border-gray-200",children:[(0,r.jsxs)(a.default,{href:"/settings",className:"flex items-center gap-2.5 px-3 py-2 rounded-lg text-sm font-medium transition-colors ".concat("/settings"===e?"bg-blue-50 text-blue-700":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,r.jsxs)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Settings"]}),(0,r.jsx)("p",{className:"px-3 mt-2 text-[10px] text-gray-400",children:"Digital Twin v2.0"})]})]})}},93583:function(e,t,n){"use strict";n.d(t,{ToastProvider:function(){return c},p:function(){return s}});var r=n(57437),a=n(2265);let o=(0,a.createContext)({toast:()=>{}});function s(){return(0,a.useContext)(o)}let i=0;function c(e){let{children:t}=e,[n,s]=(0,a.useState)([]),c=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=++i;s(r=>[...r,{id:n,text:e,type:t}]),setTimeout(()=>{s(e=>e.filter(e=>e.id!==n))},3e3)},[]);return(0,r.jsxs)(o.Provider,{value:{toast:c},children:[t,(0,r.jsx)("div",{className:"fixed bottom-4 right-4 z-50 space-y-2",children:n.map(e=>(0,r.jsx)(l,{message:e,onDismiss:()=>s(t=>t.filter(t=>t.id!==e.id))},e.id))})]})}function l(e){let{message:t,onDismiss:n}=e,a="success"===t.type?"bg-green-50 border-green-200 text-green-800":"error"===t.type?"bg-red-50 border-red-200 text-red-800":"bg-blue-50 border-blue-200 text-blue-800";return(0,r.jsxs)("div",{className:"flex items-center gap-2 px-4 py-2.5 rounded-lg border shadow-sm text-sm animate-in slide-in-from-right ".concat(a),children:[(0,r.jsx)("span",{className:"flex-1",children:t.text}),(0,r.jsx)("button",{onClick:n,className:"opacity-60 hover:opacity-100 text-xs",children:"âœ•"})]})}},88662:function(e,t,n){"use strict";n.d(t,{LiveStateProvider:function(){return p},j:function(){return f}});var r=n(57437),a=n(2265),o=n(3985),s=n(72510),i=n(83639),c=n(21212);function l(e){switch(e){case o.pr.INITIAL:return o.pr.SNAPSHOT_1;case o.pr.SNAPSHOT_1:return o.pr.SNAPSHOT_2;case o.pr.SNAPSHOT_2:return o.pr.SNAPSHOT_1}}var u=n(65056);let d=new Set(["LOW","MED","HIGH"]);function h(e,t){for(let t of e)c.vU("Validation: ".concat(t));return(0,i.sv)(),{valid:!1,errors:e,warnings:t}}let m=(0,a.createContext)({liveState:null,loading:!0,error:null,lastValidation:null,applyDemo:()=>{}});function f(){return(0,a.useContext)(m)}function p(e){let{children:t}=e,{config:n}=(0,u.c)(),[f,p]=(0,a.useState)(null),[v,g]=(0,a.useState)(null),[b,x]=(0,a.useState)(!0),[y,_]=(0,a.useState)(null),[k,j]=(0,a.useState)(null),S=(0,a.useRef)(o.pr.INITIAL),w=(0,a.useRef)(null),N=(0,a.useCallback)(async(e,t,n)=>{var r;null===(r=w.current)||void 0===r||r.abort();let a=new AbortController;w.current=a;try{let r=function(e){switch(e){case o.pr.INITIAL:case o.pr.SNAPSHOT_1:return"live_state_1.json";case o.pr.SNAPSHOT_2:return"live_state_2.json"}}(e),l=await (0,s.SE)(r,t,a.signal);if(a.signal.aborted)return;if(l){if(n){let e=function(e){let t=[],n=[];if(!e||"object"!=typeof e)return t.push("LiveState must be a non-null object"),h(t,n);if(("string"!=typeof e.snapshot_id||0===e.snapshot_id.length)&&t.push("snapshot_id must be a non-empty string"),("string"!=typeof e.timestamp||0===e.timestamp.length)&&t.push("timestamp must be a non-empty string"),"string"==typeof e.district_risk&&d.has(e.district_risk)||t.push('district_risk must be one of LOW, MED, HIGH; got "'.concat(e.district_risk,'"')),("number"!=typeof e.active_alerts||e.active_alerts<0)&&t.push("active_alerts must be a non-negative number"),"number"!=typeof e.avg_latency_ms&&t.push("avg_latency_ms must be a number"),"number"!=typeof e.camera_health_pct&&t.push("camera_health_pct must be a number"),"number"!=typeof e.forecast_horizon_min&&t.push("forecast_horizon_min must be a number"),Array.isArray(e.zones))for(let n=0;n<e.zones.length;n++){let r=function(e,t){let n=[],r="zones[".concat(t,"]");return e&&"object"==typeof e?(("string"!=typeof e.zone_id||0===e.zone_id.length)&&n.push("".concat(r,".zone_id must be a non-empty string")),("string"!=typeof e.name||0===e.name.length)&&n.push("".concat(r,".name must be a non-empty string")),"string"==typeof e.risk_level&&d.has(e.risk_level)||n.push("".concat(r,".risk_level invalid")),("number"!=typeof e.risk_score||e.risk_score<0||e.risk_score>1)&&n.push("".concat(r,".risk_score must be 0..1")),Array.isArray(e.forecast_30m)||n.push("".concat(r,".forecast_30m must be an array")),Array.isArray(e.recommendations)||n.push("".concat(r,".recommendations must be an array")),Array.isArray(e.events)||n.push("".concat(r,".events must be an array")),Array.isArray(e.interventions)||n.push("".concat(r,".interventions must be an array"))):n.push("".concat(r," must be a non-null object")),n}(e.zones[n],n);t.push(...r)}else t.push("zones must be an array");return t.length>0?h(t,n):(e.avg_latency_ms>200&&n.push("High latency: ".concat(e.avg_latency_ms,"ms")),e.camera_health_pct<90&&n.push("Low camera health: ".concat(e.camera_health_pct,"%")),{valid:!0,errors:[],warnings:n})}(l);j(e),e.valid||c.ZK("Snapshot validation failed",e.errors)}p(l),_(null),(0,i.vP)()}else _("Demo Data Unavailable")}catch(e){"AbortError"!==e.name&&_("Demo Data Unavailable")}finally{x(!1)}},[]);(0,a.useEffect)(()=>{let e=l(S.current);if(S.current=e,N(e,n.scenario,n.runtimeValidationEnabled),"paused"===n.timeMode)return;let t=setInterval(()=>{let e=l(S.current);S.current=e,N(e,n.scenario,n.runtimeValidationEnabled)},n.snapshotIntervalMs);return()=>{var e;clearInterval(t),null===(e=w.current)||void 0===e||e.abort()}},[N,n.scenario,n.timeMode,n.snapshotIntervalMs,n.runtimeValidationEnabled]);let A=(0,a.useCallback)((e,t)=>{if(!n.demoMutationEnabled){c.um("Demo mutation disabled, ignoring apply");return}let r=null!=v?v:f;r&&g(function(e,t,n){let r=new Date,a=[String(r.getUTCHours()).padStart(2,"0"),String(r.getUTCMinutes()).padStart(2,"0"),String(r.getUTCSeconds()).padStart(2,"0")].join(":"),o={id:"demo-int-".concat(Date.now()),action:n.action,applied_at:a,status:"active"},s={time:a,type:"intervention",detail:"[Demo] Applied: ".concat(n.action)},l=e.zones.map(e=>e.zone_id!==t?e:{...e,interventions:[...e.interventions,o],events:[...e.events,s]});return(0,i.L8)(),c.um("Demo intervention applied: ".concat(n.action," in ").concat(t)),{...e,zones:l}}(r,e,t))},[v,f,n.demoMutationEnabled]),M=(0,a.useMemo)(()=>f?function(e,t){if(!t)return e;let n=new Map;for(let e of t.zones)n.set(e.zone_id,e);let r=e.zones.map(e=>{let t=n.get(e.zone_id);if(!t)return e;let r=t.interventions.filter(e=>e.id.startsWith("demo-int-")),a=t.events.filter(e=>e.detail.startsWith("[Demo]"));return 0===r.length&&0===a.length?e:{...e,interventions:[...e.interventions,...r],events:[...e.events,...a]}});return{...e,zones:r}}(f,v):null,[f,v]),C=(0,a.useMemo)(()=>({liveState:M,loading:b,error:y,lastValidation:k,applyDemo:A}),[M,b,y,k,A]);return(0,r.jsx)(m.Provider,{value:C,children:t})}},72510:function(e,t,n){"use strict";n.d(t,{SE:function(){return s},uq:function(){return i}});var r=n(65056),a=n(21212),o=n(83639);async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=arguments.length>2?arguments[2]:void 0,s=performance.now();try{let i=await fetch("".concat((0,r.f)(t),"/").concat(e),{signal:n});if(!i.ok)throw Error("Failed to load live state: ".concat(i.status));let c=await i.json();return(0,o._h)(performance.now()-s,!0),a.um("Loaded snapshot ".concat(e," (").concat(t,")")),c}catch(e){return"AbortError"!==e.name&&(a.vU("loadLiveState failed",e),(0,o._h)(performance.now()-s,!1)),null}}async function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal",t=arguments.length>1?arguments[1]:void 0,n=performance.now();try{let a=await fetch("".concat((0,r.f)(e),"/incidents.json"),{signal:t});if(!a.ok)throw Error("Failed to load incidents: ".concat(a.status));let s=await a.json();return(0,o._h)(performance.now()-n,!0),{data:s,error:null}}catch(e){return"AbortError"!==e.name&&(a.vU("loadIncidents failed",e),(0,o._h)(performance.now()-n,!1)),{data:[],error:"Demo Data Unavailable"}}}},65056:function(e,t,n){"use strict";n.d(t,{DemoConfigProvider:function(){return l},c:function(){return c},f:function(){return u}});var r=n(57437),a=n(2265);let o={scenario:"normal",snapshotIntervalMs:5e3,timeMode:"live",demoMutationEnabled:!0,runtimeValidationEnabled:!0},s="schoolzone-demo-config",i=(0,a.createContext)({config:o,updateConfig:()=>{}});function c(){return(0,a.useContext)(i)}function l(e){let{children:t}=e,[n,c]=(0,a.useState)(o);(0,a.useEffect)(()=>{c(function(){try{let e=localStorage.getItem(s);if(!e)return o;let t=JSON.parse(e);return{...o,...t}}catch(e){return o}}())},[]);let l=(0,a.useCallback)(e=>{c(t=>{let n={...t,...e};return!function(e){try{localStorage.setItem(s,JSON.stringify(e))}catch(e){}}(n),n})},[]);return(0,r.jsx)(i.Provider,{value:{config:n,updateConfig:l},children:t})}function u(e){return"/mock/scenarios/".concat(e)}},21212:function(e,t,n){"use strict";n.d(t,{AF:function(){return l},ZK:function(){return i},um:function(){return s},vU:function(){return c}});let r=[];function a(){return new Date().toISOString()}function o(e){r.push(e),r.length>200&&r.shift()}function s(e,t){o({level:"info",timestamp:a(),message:e,data:t})}function i(e,t){o({level:"warn",timestamp:a(),message:e,data:t})}function c(e,t){o({level:"error",timestamp:a(),message:e,data:t})}function l(){return r}},83639:function(e,t,n){"use strict";n.d(t,{Kt:function(){return c},L8:function(){return s},_h:function(){return a},sv:function(){return i},vP:function(){return o}});let r={fetchCount:0,fetchErrorCount:0,lastFetchMs:0,lastFetchAt:null,snapshotRotations:0,demoMutationsApplied:0,validationFailures:0};function a(e,t){r.fetchCount++,r.lastFetchMs=e,r.lastFetchAt=new Date().toISOString(),!t&&r.fetchErrorCount++}function o(){r.snapshotRotations++}function s(){r.demoMutationsApplied++}function i(){r.validationFailures++}function c(){return{...r}}},3985:function(e,t,n){"use strict";var r,a,o,s;n.d(t,{pr:function(){return a},rN:function(){return r}}),(o=r||(r={})).LOW="LOW",o.MED="MED",o.HIGH="HIGH",(s=a||(a={})).INITIAL="INITIAL",s.SNAPSHOT_1="SNAPSHOT_1",s.SNAPSHOT_2="SNAPSHOT_2"},99376:function(e,t,n){"use strict";var r=n(35475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},47960:function(){},44742:function(e){e.exports={style:{fontFamily:"'__Inter_f367f3', '__Inter_Fallback_f367f3'",fontStyle:"normal"},className:"__className_f367f3"}}},function(e){e.O(0,[540,648,971,117,744],function(){return e(e.s=28279)}),_N_E=e.O()}]);